<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>C Preprocessor</title>
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<title>andersch.dev</title>
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="stylesheet" href="/style.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Ubuntu:regular,bold&subset=Latin"><script type="text/javascript" src="/script.js" defer></script>
</head>
<body>
<header id="top" class="status">
<header>
<h1 class="title" id="title"><a href="/">andersch.dev</a></h1>

<div class="icons">
  	<a id="icon-github" href="https://github.com/dandersch" ><span>dandersch</span><img src="/icons/github.svg"></a>
  	<a id="icon-feed"   href="https://andersch.dev/feed.xml" target="_blank"><img src="/icons/rss.svg"><span></span></a>
  	<a id="icon-mail"   href="mailto:contact [at} andersch {dot) dev"  ><img src="/icons/mail.svg"><span>contact [at} andersch {dot) dev</span></a>
</div>
<div>
	<nav class="nav">
		<a class="nav-link" href="/article">article</a>
		<a class="nav-link" href="/project">project</a>
		<a class="nav-link" href="/other">other</a>
		<a class="nav-link" href="/notes">wiki</a>
	</nav>
</div>
</header>
</header>
<main id="content" class="content">
<div class="tags-date-box"><div class="tags"><code>[ <a href="/tag/c.html">c</a> ]</code></div></div><h1>C Preprocessor</h1>
<p>
The C preprocessor is a program that is invoked as a pre-compilation step for <a href="c.html#ID-3a2b1a06-f048-460c-9944-04b11d4fdbcd">C</a>,
<a href="cpp.html#ID-80c2bb59-9fc3-4d2b-8ae3-574a6b24d089">C++</a> and Objective-C. It is concerned with the inclusion of header files, macro
expansion and conditional compilation.
</p>

<p>
It can be used to have a rudimentary form of <a href="metaprogramming.html#ID-6c88dda7-d440-48d0-ad7b-9910400eab90">metaprogramming</a> inside C, e.g. by
using <a href="x_macro.html#ID-03fc9819-f8da-43b5-b91e-c3fd9d435e55">X-Macros</a>.
</p>
<div id="outline-container-org02f669a" class="outline-2">
<h2 id="org02f669a"><a href="#org02f669a">Tips &amp; Tricks</a></h2>
<div class="outline-text-2" id="text-org02f669a">
</div>
<div id="outline-container-org53f14f2" class="outline-3">
<h3 id="org53f14f2"><a href="#org53f14f2">For-loop-based scope macros</a></h3>
<div class="outline-text-3" id="text-org53f14f2">
<div class="org-src-container">
<pre class="src src-C"><span class="org-comment-delimiter">/* </span><span class="org-comment">helper macros</span><span class="org-comment-delimiter"> */</span>
<span class="org-preprocessor">#define</span> <span class="org-function-name">TOKEN_PASTE</span>(<span class="org-variable-name">a</span>, <span class="org-variable-name">b</span>) a##b
<span class="org-preprocessor">#define</span> <span class="org-function-name">CONCAT</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>) TOKEN_PASTE(a,b)
<span class="org-preprocessor">#define</span> <span class="org-function-name">UQ</span>(<span class="org-variable-name">name</span>) CONCAT(name, __LINE__) <span class="org-comment-delimiter">/* </span><span class="org-comment">unique identifier</span><span class="org-comment-delimiter"> */</span>

<span class="org-comment-delimiter">/* </span><span class="org-comment">repeat an expression count times (useful in combination with other macros)</span><span class="org-comment-delimiter"> */</span>
<span class="org-preprocessor">#define</span> <span class="org-function-name">repeat</span>(<span class="org-variable-name">expr</span>, <span class="org-variable-name">count</span>) \
    <span class="org-keyword">for</span> (<span class="org-type">int</span> <span class="org-function-name">UQ</span>(i) = 0; (UQ(i) &lt; count) ? 1 : 0 ; (UQ(i) += 1, expr))

<span class="org-comment-delimiter">/* </span><span class="org-comment">repeat an expression count times with a begin and end expression (useful in combination with other macros)</span><span class="org-comment-delimiter"> */</span>
<span class="org-preprocessor">#define</span> <span class="org-function-name">for_begin_repeat_end</span>(<span class="org-variable-name">begin</span>, <span class="org-variable-name">repeat</span>, <span class="org-variable-name">count</span>, <span class="org-variable-name">end</span>) \
    <span class="org-keyword">for</span> (<span class="org-type">int</span> <span class="org-function-name">UQ</span>(i) = (begin, 0); (UQ(i) &lt; count) ? 1 : (end,0) ; (UQ(i) += 1, repeat))

<span class="org-comment-delimiter">/* </span><span class="org-comment">open a scope with a begin and end expression (useful by itself and in other macros)</span><span class="org-comment-delimiter"> */</span>
<span class="org-preprocessor">#define</span> <span class="org-function-name">scope_begin_end</span>(<span class="org-variable-name">begin</span>, <span class="org-variable-name">end</span>) \
    <span class="org-keyword">for</span> (<span class="org-type">int</span> <span class="org-function-name">UQ</span>(i) = (begin, 0); (UQ(i) == 0); (UQ(i) += 1), end)

<span class="org-comment-delimiter">/* </span><span class="org-comment">defer expressions to the end of the scope (useful by itself)</span><span class="org-comment-delimiter"> */</span>
<span class="org-preprocessor">#define</span> <span class="org-function-name">scope_defer</span>(...) \
    <span class="org-keyword">for</span> (<span class="org-type">int</span> <span class="org-function-name">UQ</span>(i) = 0; UQ(i) == 0; (UQ(i) += 1), __VA_ARGS__)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgeae363d" class="outline-3">
<h3 id="orgeae363d"><a href="#orgeae363d">Check for equality</a></h3>
<div class="outline-text-3" id="text-orgeae363d">
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#if</span> RENDERER_BACKEND == RENDERER_OPENGL
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf541c13" class="outline-3">
<h3 id="orgf541c13"><a href="#orgf541c13"><code>#line</code> directive</a></h3>
<div class="outline-text-3" id="text-orgf541c13">
<p>
Use the <code>#line</code> directive to set the <code>__LINE__</code> macro to a positive integer of your choice.
It can also set <code>__FILE__</code>.
</p>

<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#line</span> 0 <span class="org-string">"filename"</span>
printf(<span class="org-string">"%d %s\n"</span>, __LINE__, __FILE__);
</pre>
</div>

<p>
This can be useful when <code>__LINE__</code> is used for setting bitfield values in a <code>.def</code> file:
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-comment-delimiter">/*</span>
<span class="org-comment"> * Comment that would add to __LINE__, even though we want it to start at 0</span>
<span class="org-comment-delimiter"> */</span>
<span class="org-preprocessor">#line</span> 0
<span class="org-function-name">LOG_ENTRY_SEVERITY</span>(   TRACE,        (1&lt;&lt;__LINE__),    <span class="org-string">"[TRACE]"</span>,     LOG_COLOR_GRAY    )
<span class="org-function-name">LOG_ENTRY_SEVERITY</span>(   INFO,         (1&lt;&lt;__LINE__),    <span class="org-string">"[INFO ]"</span>,     LOG_COLOR_GREEN   )
<span class="org-function-name">LOG_ENTRY_SEVERITY</span>(   WARN,         (1&lt;&lt;__LINE__),    <span class="org-string">"[WARN ]"</span>,     LOG_COLOR_YELLOW  )
<span class="org-function-name">LOG_ENTRY_SEVERITY</span>(   ERROR,        (1&lt;&lt;__LINE__),    <span class="org-string">"[ERROR]"</span>,     LOG_COLOR_RED     )
<span class="org-function-name">LOG_ENTRY_SEVERITY</span>(   FATAL,        (1&lt;&lt;__LINE__),    <span class="org-string">"[FATAL]"</span>,     LOG_COLOR_PURPLE  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orga575165" class="outline-3">
<h3 id="orga575165"><a href="#orga575165">Statement Expressions</a></h3>
<div class="outline-text-3" id="text-orga575165">
<p>
GNU C (and C++) has an <a href="gnu_c_ext.html#ID-8ab219e8-3a61-4f3c-836a-464c4ad8ba0c">extension</a> for having <a href="https://gcc.gnu.org/onlinedocs/gcc/Statement-Exprs.html">statements and declarations inside
an expression</a>:
</p>

<div class="org-src-container">
<pre class="src src-C"><span class="org-comment-delimiter">// </span><span class="org-comment">computes expressions a and b only once</span>
<span class="org-preprocessor">#define</span> <span class="org-function-name">max</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>) ((a) &gt; (b) ? (a) : (b))
<span class="org-preprocessor">#define</span> <span class="org-function-name">max_safe</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>) ({<span class="org-type">int</span> <span class="org-variable-name">_a</span> = (a), <span class="org-variable-name">_b</span> = (b); _a &gt; _b ? _a : _b; })

<span class="org-type">int</span> <span class="org-variable-name">a</span> = 4, <span class="org-variable-name">b</span> = 4;
printf(<span class="org-string">"Normal macro: %i\n"</span>, max(++a, b));
a = 4, b = 4;
printf(<span class="org-string">"State expr:   %i\n"</span>, max_safe(++a, b));
</pre>
</div>

<p>
This extension is implemented on:
</p>
<ul class="org-ul">
<li><code>gcc</code>, <code>g++</code>, <code>clang</code>, <code>clang++</code></li>
<li><code>clang-cl.exe</code>, <code>clang.exe</code>, <code>clang++.exe</code></li>
<li><code>tcc</code></li>
</ul>
</div>
</div>
<div id="outline-container-org4a72936" class="outline-3">
<h3 id="org4a72936"><a href="#org4a72936">For-each construct</a></h3>
<div class="outline-text-3" id="text-org4a72936">
<p>
See <a href="https://codecraft.co/2014/11/25/variadic-macros-tricks/">Variadic macros tricks</a>:
</p>

<div class="org-src-container">
<pre class="src src-C" id="macro_for_each"><span class="org-comment-delimiter">// </span><span class="org-comment">Accept any number of args &gt;= N, but expand to just the Nth one.</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">Here, N == 6.</span>
<span class="org-preprocessor">#define</span> <span class="org-function-name">_GET_NTH_ARG</span>(<span class="org-variable-name">_1</span>, <span class="org-variable-name">_2</span>, <span class="org-variable-name">_3</span>, <span class="org-variable-name">_4</span>, <span class="org-variable-name">_5</span>, <span class="org-variable-name">N</span>, ...) N

<span class="org-comment-delimiter">// </span><span class="org-comment">Define some macros to help us create overrides based on the</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">arity of a for-each-style macro.</span>
<span class="org-preprocessor">#define</span> <span class="org-function-name">_fe_0</span>(<span class="org-variable-name">_call</span>, ...)
<span class="org-preprocessor">#define</span> <span class="org-function-name">_fe_1</span>(<span class="org-variable-name">_call</span>, <span class="org-variable-name">x</span>) _call(x)
<span class="org-preprocessor">#define</span> <span class="org-function-name">_fe_2</span>(<span class="org-variable-name">_call</span>, <span class="org-variable-name">x</span>, ...) _call(x) _fe_1(_call, __VA_ARGS__)
<span class="org-preprocessor">#define</span> <span class="org-function-name">_fe_3</span>(<span class="org-variable-name">_call</span>, <span class="org-variable-name">x</span>, ...) _call(x) _fe_2(_call, __VA_ARGS__)
<span class="org-preprocessor">#define</span> <span class="org-function-name">_fe_4</span>(<span class="org-variable-name">_call</span>, <span class="org-variable-name">x</span>, ...) _call(x) _fe_3(_call, __VA_ARGS__)

<span class="org-doc">/**</span>
<span class="org-doc"> * Provide a for-each construct for variadic macros. Supports up</span>
<span class="org-doc"> * to 4 args.</span>
<span class="org-doc"> *</span>
<span class="org-doc"> * Example usage1:</span>
<span class="org-doc"> *     </span><span class="org-doc"><span class="org-doc-markup">#define</span></span><span class="org-doc"> FWD_DECLARE_CLASS(cls) class cls;</span>
<span class="org-doc"> *     CALL_MACRO_X_FOR_EACH(FWD_DECLARE_CLASS, Foo, Bar)</span>
<span class="org-doc"> *</span>
<span class="org-doc"> * Example usage 2:</span>
<span class="org-doc"> *     </span><span class="org-doc"><span class="org-doc-markup">#define</span></span><span class="org-doc"> START_NS(ns) namespace ns {</span>
<span class="org-doc"> *     </span><span class="org-doc"><span class="org-doc-markup">#define</span></span><span class="org-doc"> END_NS(ns) }</span>
<span class="org-doc"> *     </span><span class="org-doc"><span class="org-doc-markup">#define</span></span><span class="org-doc"> MY_NAMESPACES System, Net, Http</span>
<span class="org-doc"> *     CALL_MACRO_X_FOR_EACH(START_NS, MY_NAMESPACES)</span>
<span class="org-doc"> *     typedef foo int;</span>
<span class="org-doc"> *     CALL_MACRO_X_FOR_EACH(END_NS, MY_NAMESPACES)</span>
<span class="org-doc"> */</span>
<span class="org-preprocessor">#define</span> <span class="org-function-name">CALL_MACRO_X_FOR_EACH</span>(<span class="org-variable-name">x</span>, ...) \
    _GET_NTH_ARG(<span class="org-string">"ignored"</span>, ##__VA_ARGS__, \
    _fe_4, _fe_3, _fe_2, _fe_1, _fe_0)(x, ##__VA_ARGS__)
</pre>
</div>
</div>
</div>
<div id="outline-container-org3f57576" class="outline-3">
<h3 id="org3f57576"><a href="#org3f57576">Unix Timestamp</a></h3>
<div class="outline-text-3" id="text-org3f57576">
<div class="org-src-container">
<pre class="src src-C"><span class="org-comment-delimiter">/*</span>
<span class="org-comment"> * compile_time.h</span>
<span class="org-comment"> *</span>
<span class="org-comment"> * Created: 30.05.2017 20:57:58</span>
<span class="org-comment"> *  Author: Dennis (instructable.com/member/nqtronix)</span>
<span class="org-comment"> *</span>
<span class="org-comment"> * This code provides the macro __TIME_UNIX__ which returns the current time in UNIX format. It can</span>
<span class="org-comment"> * be used to identify a version of code on an embedded device, to initialize its RTC and much more.</span>
<span class="org-comment"> * Along that several more constants for seconds, minutes, etc. are provided</span>
<span class="org-comment"> *</span>
<span class="org-comment"> * The macro is based on __TIME__ and __DATE__, which are assumed to be formatted "HH:MM:SS" and</span>
<span class="org-comment"> * "MMM DD YYYY", respectively. The actual value can be calculated by the C compiler at compile time</span>
<span class="org-comment"> * as all inputs are literals. MAKE SURE TO ENABLE OPTIMISATION!</span>
<span class="org-comment-delimiter"> */</span>

<span class="org-preprocessor">#if</span><span class="org-negation-char"><span class="org-preprocessor">n</span></span><span class="org-preprocessor">def</span> COMPILE_TIME_H_
<span class="org-preprocessor">#define</span> <span class="org-variable-name">COMPILE_TIME_H_</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">extracts 1..4 characters from a string and interprets it as a decimal value</span>
<span class="org-preprocessor">#define</span> <span class="org-function-name">CONV_STR2DEC_1</span>(<span class="org-variable-name">str</span>, <span class="org-variable-name">i</span>)  (str[i]&gt;<span class="org-string">'0'</span>?str[i]-<span class="org-string">'0'</span>:0)
<span class="org-preprocessor">#define</span> <span class="org-function-name">CONV_STR2DEC_2</span>(<span class="org-variable-name">str</span>, <span class="org-variable-name">i</span>)  (CONV_STR2DEC_1(str, i)*10 + str[i+1]-<span class="org-string">'0'</span>)
<span class="org-preprocessor">#define</span> <span class="org-function-name">CONV_STR2DEC_3</span>(<span class="org-variable-name">str</span>, <span class="org-variable-name">i</span>)  (CONV_STR2DEC_2(str, i)*10 + str[i+2]-<span class="org-string">'0'</span>)
<span class="org-preprocessor">#define</span> <span class="org-function-name">CONV_STR2DEC_4</span>(<span class="org-variable-name">str</span>, <span class="org-variable-name">i</span>)  (CONV_STR2DEC_3(str, i)*10 + str[i+3]-<span class="org-string">'0'</span>)

<span class="org-comment-delimiter">// </span><span class="org-comment">Some definitions for calculation</span>
<span class="org-preprocessor">#define</span> <span class="org-variable-name">SEC_PER_MIN</span>             60UL
<span class="org-preprocessor">#define</span> <span class="org-variable-name">SEC_PER_HOUR</span>            3600UL
<span class="org-preprocessor">#define</span> <span class="org-variable-name">SEC_PER_DAY</span>             86400UL
<span class="org-preprocessor">#define</span> <span class="org-variable-name">SEC_PER_YEAR</span>            (SEC_PER_DAY*365)
<span class="org-preprocessor">#define</span> <span class="org-variable-name">UNIX_START_YEAR</span>         1970UL

<span class="org-comment-delimiter">// </span><span class="org-comment">Custom "glue logic" to convert the month name to a usable number</span>
<span class="org-preprocessor">#define</span> <span class="org-function-name">GET_MONTH</span>(<span class="org-variable-name">str</span>, <span class="org-variable-name">i</span>)      (str[i]==<span class="org-string">'J'</span> &amp;&amp; str[i+1]==<span class="org-string">'a'</span> &amp;&amp; str[i+2]==<span class="org-string">'n'</span> ? 1 :     \
                                str[i]==<span class="org-string">'F'</span> &amp;&amp; str[i+1]==<span class="org-string">'e'</span> &amp;&amp; str[i+2]==<span class="org-string">'b'</span> ? 2 :     \
                                str[i]==<span class="org-string">'M'</span> &amp;&amp; str[i+1]==<span class="org-string">'a'</span> &amp;&amp; str[i+2]==<span class="org-string">'r'</span> ? 3 :     \
                                str[i]==<span class="org-string">'A'</span> &amp;&amp; str[i+1]==<span class="org-string">'p'</span> &amp;&amp; str[i+2]==<span class="org-string">'r'</span> ? 4 :     \
                                str[i]==<span class="org-string">'M'</span> &amp;&amp; str[i+1]==<span class="org-string">'a'</span> &amp;&amp; str[i+2]==<span class="org-string">'y'</span> ? 5 :     \
                                str[i]==<span class="org-string">'J'</span> &amp;&amp; str[i+1]==<span class="org-string">'u'</span> &amp;&amp; str[i+2]==<span class="org-string">'n'</span> ? 6 :     \
                                str[i]==<span class="org-string">'J'</span> &amp;&amp; str[i+1]==<span class="org-string">'u'</span> &amp;&amp; str[i+2]==<span class="org-string">'l'</span> ? 7 :     \
                                str[i]==<span class="org-string">'A'</span> &amp;&amp; str[i+1]==<span class="org-string">'u'</span> &amp;&amp; str[i+2]==<span class="org-string">'g'</span> ? 8 :     \
                                str[i]==<span class="org-string">'S'</span> &amp;&amp; str[i+1]==<span class="org-string">'e'</span> &amp;&amp; str[i+2]==<span class="org-string">'p'</span> ? 9 :     \
                                str[i]==<span class="org-string">'O'</span> &amp;&amp; str[i+1]==<span class="org-string">'c'</span> &amp;&amp; str[i+2]==<span class="org-string">'t'</span> ? 10 :    \
                                str[i]==<span class="org-string">'N'</span> &amp;&amp; str[i+1]==<span class="org-string">'o'</span> &amp;&amp; str[i+2]==<span class="org-string">'v'</span> ? 11 :    \
                                str[i]==<span class="org-string">'D'</span> &amp;&amp; str[i+1]==<span class="org-string">'e'</span> &amp;&amp; str[i+2]==<span class="org-string">'c'</span> ? 12 : 0)

<span class="org-preprocessor">#define</span> <span class="org-function-name">GET_MONTH2DAYS</span>(<span class="org-variable-name">month</span>)  ((month == 1 ? 0 : 31 +                      \
                                (month == 2 ? 0 : 28 +                      \
                                (month == 3 ? 0 : 31 +                      \
                                (month == 4 ? 0 : 30 +                      \
                                (month == 5 ? 0 : 31 +                      \
                                (month == 6 ? 0 : 30 +                      \
                                (month == 7 ? 0 : 31 +                      \
                                (month == 8 ? 0 : 31 +                      \
                                (month == 9 ? 0 : 30 +                      \
                                (month == 10 ? 0 : 31 +                     \
                                (month == 11 ? 0 : 30))))))))))))           \


<span class="org-preprocessor">#define</span> <span class="org-variable-name">GET_LEAP_DAYS</span>           ((__TIME_YEARS__-1968)/4 - (__TIME_MONTH__ &lt;=2 ? 1 : 0))



<span class="org-preprocessor">#define</span> <span class="org-variable-name">__TIME_SECONDS__</span>        CONV_STR2DEC_2(__TIME__, 6)
<span class="org-preprocessor">#define</span> <span class="org-variable-name">__TIME_MINUTES__</span>        CONV_STR2DEC_2(__TIME__, 3)
<span class="org-preprocessor">#define</span> <span class="org-variable-name">__TIME_HOURS__</span>          CONV_STR2DEC_2(__TIME__, 0)
<span class="org-preprocessor">#define</span> <span class="org-variable-name">__TIME_DAYS__</span>           CONV_STR2DEC_2(__DATE__, 4)
<span class="org-preprocessor">#define</span> <span class="org-variable-name">__TIME_MONTH__</span>          GET_MONTH(__DATE__, 0)
<span class="org-preprocessor">#define</span> <span class="org-variable-name">__TIME_YEARS__</span>          CONV_STR2DEC_4(__DATE__, 7)

<span class="org-preprocessor">#define</span> <span class="org-variable-name">__TIME_UNIX__</span>         ((__TIME_YEARS__-UNIX_START_YEAR)*SEC_PER_YEAR+       \
                                GET_LEAP_DAYS*SEC_PER_DAY+                          \
                                GET_MONTH2DAYS(__TIME_MONTH__)*SEC_PER_DAY+         \
                                __TIME_DAYS__*SEC_PER_DAY-SEC_PER_DAY+              \
                                __TIME_HOURS__*SEC_PER_HOUR+                        \
                                __TIME_MINUTES__*SEC_PER_MIN+                       \
                                __TIME_SECONDS__)

<span class="org-preprocessor">#endif</span> <span class="org-comment-delimiter">/* </span><span class="org-comment">COMPILE_TIME_H_</span><span class="org-comment-delimiter"> */</span>

<span class="org-preprocessor">#include</span> <span class="org-string">&lt;stdio.h&gt;</span>
<span class="org-type">int</span> <span class="org-function-name">main</span>() {
    printf(<span class="org-string">"%d\n"</span>, __TIME_UNIX__);
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd7c81fe" class="outline-3">
<h3 id="orgd7c81fe"><a href="#orgd7c81fe">Time as Integers</a></h3>
<div class="outline-text-3" id="text-orgd7c81fe">
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#define</span> <span class="org-variable-name">DAY</span>    ((__DATE__[4] - <span class="org-string">'0'</span>) * 10 + (__DATE__[5] - <span class="org-string">'0'</span>))
<span class="org-preprocessor">#define</span> <span class="org-variable-name">YEAR</span>   ((__DATE__[7] - <span class="org-string">'0'</span>) * 1000 + (__DATE__[8] - <span class="org-string">'0'</span>) * 100 + (__DATE__[9] - <span class="org-string">'0'</span>) * 10 + (__DATE__[10] - <span class="org-string">'0'</span>))
<span class="org-preprocessor">#define</span> <span class="org-variable-name">HOUR</span>   ((__TIME__[0] - <span class="org-string">'0'</span>) * 10 + (__TIME__[1] - <span class="org-string">'0'</span>))
<span class="org-preprocessor">#define</span> <span class="org-variable-name">MINUTE</span> ((__TIME__[3] - <span class="org-string">'0'</span>) * 10 + (__TIME__[4] - <span class="org-string">'0'</span>))
<span class="org-preprocessor">#define</span> <span class="org-variable-name">SECOND</span> ((__TIME__[6] - <span class="org-string">'0'</span>) * 10 + (__TIME__[7] - <span class="org-string">'0'</span>))
<span class="org-preprocessor">#define</span> <span class="org-variable-name">TIMESTAMP</span> ((HOUR * 60 * 60) + (MINUTE * 60) + SECOND) <span class="org-comment-delimiter">// </span><span class="org-comment">seconds today</span>

<span class="org-preprocessor">#include</span> <span class="org-string">&lt;stdio.h&gt;</span>
<span class="org-type">int</span> <span class="org-function-name">main</span>() {
  printf(<span class="org-string">"%d:%d:%d\n"</span>, HOUR, MINUTE, SECOND);
  printf(<span class="org-string">"%s\n"</span>, __TIME__);
  printf(<span class="org-string">"%d\n"</span>, TIMESTAMP);
  printf(<span class="org-string">"%s\n"</span>, __DATE__);
  printf(<span class="org-string">"%d\n"</span>, DAY);
  printf(<span class="org-string">"%d\n"</span>, YEAR);
  printf(<span class="org-string">"%s\n"</span>, __TIMESTAMP__);
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orge5d1a96" class="outline-3">
<h3 id="orge5d1a96"><a href="#orge5d1a96">Running code after the user</a></h3>
<div class="outline-text-3" id="text-orge5d1a96">
<p>
Using for loops, we can "sneak" expressions to run after the user's code has
run. However, to run whole code snippets containing several statement (without
using GNU statement expressions) use a combination of <code>goto</code>, <code>while</code>, and <code>if-else</code>:
</p>

<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#define</span> <span class="org-function-name">m</span>(<span class="org-variable-name">code</span>)              \
    <span class="org-keyword">if</span> (1) <span class="org-keyword">goto</span> <span class="org-constant">_body</span>;       \
    <span class="org-keyword">else</span> <span class="org-keyword">while</span> (1)           \
        <span class="org-keyword">if</span> (1) {             \
            code             \
            <span class="org-keyword">break</span>;           \
        } <span class="org-keyword">else</span> _body:

<span class="org-comment-delimiter">/* </span><span class="org-comment">usage</span><span class="org-comment-delimiter"> */</span>
m({
    printf(<span class="org-string">" "</span>);
    printf(<span class="org-string">"World\n"</span>);
  }) {
    printf(<span class="org-string">"Hello"</span>);
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org7c26efc" class="outline-3">
<h3 id="org7c26efc"><a href="#org7c26efc">Overriding Macros Based on Number of Arguments</a></h3>
<div class="outline-text-3" id="text-org7c26efc">
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#define</span> <span class="org-function-name">CAT</span>( <span class="org-variable-name">A</span>, <span class="org-variable-name">B</span> ) A ## B
<span class="org-preprocessor">#define</span> <span class="org-function-name">SELECT</span>( <span class="org-variable-name">NAME</span>, <span class="org-variable-name">NUM</span> ) CAT( NAME ## _, NUM )
<span class="org-preprocessor">#define</span> <span class="org-function-name">GET_COUNT</span>( <span class="org-variable-name">_1</span>, <span class="org-variable-name">_2</span>, <span class="org-variable-name">_3</span>, <span class="org-variable-name">_4</span>, <span class="org-variable-name">_5</span>, <span class="org-variable-name">_6</span> <span class="org-comment-delimiter">/* </span><span class="org-comment">ad nauseam</span><span class="org-comment-delimiter"> */</span>, <span class="org-variable-name">COUNT</span>, ... ) COUNT
<span class="org-preprocessor">#define</span> <span class="org-function-name">VA_SIZE</span>( ... ) GET_COUNT( __VA_ARGS__, 6, 5, 4, 3, 2, 1 )
<span class="org-preprocessor">#define</span> <span class="org-function-name">VA_SELECT</span>( <span class="org-variable-name">NAME</span>, ... ) SELECT( NAME, VA_SIZE(__VA_ARGS__) )(__VA_ARGS__)

<span class="org-comment-delimiter">/* </span><span class="org-comment">usage code</span><span class="org-comment-delimiter"> */</span>
<span class="org-preprocessor">#define</span> <span class="org-function-name">_ret</span>( ... )     VA_SELECT( _ret, __VA_ARGS__ )
<span class="org-preprocessor">#define</span> <span class="org-function-name">_ret_1</span>(<span class="org-variable-name">a</span>)       <span class="org-keyword">struct</span> <span class="org-type">_</span>##a          { <span class="org-type">a</span> <span class="org-variable-name">_0</span>; }
<span class="org-preprocessor">#define</span> <span class="org-function-name">_ret_2</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>)     <span class="org-keyword">struct</span> <span class="org-type">_</span>##a##b       { <span class="org-type">a</span> <span class="org-variable-name">_0</span>; <span class="org-type">b</span> <span class="org-variable-name">_1</span>; }
<span class="org-preprocessor">#define</span> <span class="org-function-name">_ret_3</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>,<span class="org-variable-name">c</span>)   <span class="org-keyword">struct</span> <span class="org-type">_</span>##a##b##c    { <span class="org-type">a</span> <span class="org-variable-name">_0</span>; <span class="org-type">b</span> <span class="org-variable-name">_1</span>; <span class="org-type">c</span> <span class="org-variable-name">_2</span>; }
<span class="org-preprocessor">#define</span> <span class="org-function-name">_ret_4</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>,<span class="org-variable-name">c</span>,<span class="org-variable-name">d</span>) <span class="org-keyword">struct</span> <span class="org-type">_</span>##a##b##c##d { <span class="org-type">a</span> <span class="org-variable-name">_0</span>; <span class="org-type">b</span> <span class="org-variable-name">_1</span>; <span class="org-type">c</span> <span class="org-variable-name">_2</span>; <span class="org-type">d</span> <span class="org-variable-name">_3</span>; }
</pre>
</div>
</div>
</div>
<div id="outline-container-orgacc10aa" class="outline-3">
<h3 id="orgacc10aa"><a href="#orgacc10aa">Resetting <code>__COUNTER__</code></a></h3>
<div class="outline-text-3" id="text-orgacc10aa">
<div class="org-src-container">
<pre class="src src-C">printf(<span class="org-string">"%i\n"</span>, __COUNTER__);
printf(<span class="org-string">"%i\n"</span>, __COUNTER__);
printf(<span class="org-string">"%i\n"</span>, __COUNTER__);

<span class="org-comment-delimiter">// </span><span class="org-comment">safe line setting</span>
<span class="org-preprocessor">#0</span><span class="org-string">""</span>1
<span class="org-preprocessor">#line</span> __COUNTER__
printf (<span class="org-string">"%i\n"</span>, __COUNTER__ - __LINE__ - 1); <span class="org-comment-delimiter">// </span><span class="org-comment">0</span>
<span class="org-preprocessor">#0</span><span class="org-string">""</span>2
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orged9ed72" class="outline-2">
<h2 id="orged9ed72"><a href="#orged9ed72">Semi-useful Hacks</a></h2>
<div class="outline-text-2" id="text-orged9ed72">
</div>
<div id="outline-container-org7635475" class="outline-3">
<h3 id="org7635475"><a href="#org7635475">Keeping track of the callstack</a></h3>
<div class="outline-text-3" id="text-org7635475">
<p>
Following macros and functions can keep a printable string of the current
callstack at all times and run functions (e.g. a logger, profiler) when entering
a function (technically just before entering it), and after returning from it.
It can also be used to implicitly pass a parameter (e.g. a context or allocator)
to every function
</p>

<div class="org-src-container">
<pre class="src src-C" id="callstack_t"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;stdio.h&gt;</span>
<span class="org-preprocessor">#include</span> <span class="org-string">&lt;string.h&gt;</span>

<span class="org-keyword">typedef</span> <span class="org-keyword">struct</span> <span class="org-type">callstack_t</span> {
        <span class="org-type">char</span> <span class="org-variable-name">funcs</span>[256];
        <span class="org-type">int</span>  <span class="org-variable-name">index</span>;
        <span class="org-type">int</span>  <span class="org-variable-name">i</span>;
} <span class="org-type">callstack_t</span>;

<span class="org-preprocessor">#define</span> <span class="org-function-name">callstack_init</span>() <span class="org-type">callstack_t</span> <span class="org-variable-name">callstack</span> = {0}; callstack = callstack_enter_function(callstack, __FUNCTION__)
<span class="org-type">callstack_t</span> <span class="org-function-name">callstack_enter_function</span>(<span class="org-type">callstack_t</span> <span class="org-variable-name">callstack</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">function</span>) {
    callstack.funcs[callstack.index++] = <span class="org-string">'|'</span>;
    <span class="org-keyword">for</span> (<span class="org-type">int</span> <span class="org-variable-name">i</span> = 0; i &lt; strlen(function); i++) {
        callstack.funcs[callstack.index] = function[i];
        callstack.index++;
    }
    <span class="org-comment-delimiter">//</span><span class="org-comment">callstack.funcs[callstack.index++] = '\0';</span>
    <span class="org-keyword">return</span> callstack;
}
<span class="org-type">callstack_t</span> <span class="org-function-name">callstack_return_from_function</span>(<span class="org-type">callstack_t</span> <span class="org-variable-name">callstack</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">function</span>) {
    callstack.index -= strlen(function);
    callstack.funcs[callstack.index] = <span class="org-string">'\0'</span>;
    <span class="org-keyword">return</span> callstack;
}
<span class="org-type">callstack_t</span> <span class="org-function-name">callstack_print</span>(<span class="org-type">callstack_t</span> <span class="org-variable-name">callstack</span>) {
    printf(<span class="org-string">"%s\n"</span>, callstack.funcs);
}

<span class="org-comment-delimiter">/* </span><span class="org-comment">helper macros</span><span class="org-comment-delimiter"> */</span>
<span class="org-preprocessor">#define</span> <span class="org-function-name">TOKEN_PASTE</span>(<span class="org-variable-name">a</span>, <span class="org-variable-name">b</span>) a##b
<span class="org-preprocessor">#define</span> <span class="org-function-name">CONCAT</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>) TOKEN_PASTE(a,b)
<span class="org-preprocessor">#define</span> <span class="org-function-name">UQ</span>(<span class="org-variable-name">name</span>) CONCAT(name, __LINE__) <span class="org-comment-delimiter">// </span><span class="org-comment">UNIQUE IDENTIFIER</span>

<span class="org-preprocessor">#define</span> <span class="org-variable-name">TRACE_CALLSTACK</span>
<span class="org-preprocessor">#ifdef</span> TRACE_CALLSTACK
<span class="org-preprocessor">  #define</span> <span class="org-function-name">FUNC_DECL</span>(<span class="org-variable-name">ret</span>, <span class="org-variable-name">function</span>, ...) <span class="org-type">ret</span> <span class="org-function-name">function</span>(<span class="org-type">callstack_t</span> <span class="org-variable-name">callstack</span>, ##__VA_ARGS__)
<span class="org-preprocessor">  #define</span> <span class="org-function-name">FUNC_CALL</span>(<span class="org-variable-name">function</span>, ...) \
    <span class="org-keyword">for</span> (<span class="org-type">callstack_t</span> <span class="org-function-name">UQ</span>(temp) = (callstack = callstack_enter_function(callstack, #function)); \
         UQ(temp).i == 0; (UQ(temp).i++, callstack_return_from_function(callstack, #function))) { function(callstack, ##__VA_ARGS__); }
<span class="org-preprocessor">#else</span>
<span class="org-preprocessor">  #define</span> <span class="org-function-name">FUNC_DECL</span>(<span class="org-variable-name">ret</span>, <span class="org-variable-name">function</span>, ...) <span class="org-type">ret</span> <span class="org-function-name">function</span>(__VA_ARGS__)
<span class="org-preprocessor">  #define</span> <span class="org-function-name">FUNC_CALL</span>(<span class="org-variable-name">function</span>, ...) function(__VA_ARGS__)
<span class="org-preprocessor">#endif</span>
</pre>
</div>

<p>
However, the usage code is invasive to the point that every function call and
function declaration/implementation needs to be wrapped in a macro:
</p>

<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;stdio.h&gt;</span>
<span class="org-preprocessor">#include</span> <span class="org-string">&lt;string.h&gt;</span>

<span class="org-keyword">typedef</span> <span class="org-keyword">struct</span> <span class="org-type">callstack_t</span> {
        <span class="org-type">char</span> <span class="org-variable-name">funcs</span>[256];
        <span class="org-type">int</span>  <span class="org-variable-name">index</span>;
        <span class="org-type">int</span>  <span class="org-variable-name">i</span>;
} <span class="org-type">callstack_t</span>;

<span class="org-preprocessor">#define</span> <span class="org-function-name">callstack_init</span>() <span class="org-type">callstack_t</span> <span class="org-variable-name">callstack</span> = {0}; callstack = callstack_enter_function(callstack, __FUNCTION__)
<span class="org-type">callstack_t</span> <span class="org-function-name">callstack_enter_function</span>(<span class="org-type">callstack_t</span> <span class="org-variable-name">callstack</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">function</span>) {
    callstack.funcs[callstack.index++] = <span class="org-string">'|'</span>;
    <span class="org-keyword">for</span> (<span class="org-type">int</span> <span class="org-variable-name">i</span> = 0; i &lt; strlen(function); i++) {
        callstack.funcs[callstack.index] = function[i];
        callstack.index++;
    }
    <span class="org-comment-delimiter">//</span><span class="org-comment">callstack.funcs[callstack.index++] = '\0';</span>
    <span class="org-keyword">return</span> callstack;
}
<span class="org-type">callstack_t</span> <span class="org-function-name">callstack_return_from_function</span>(<span class="org-type">callstack_t</span> <span class="org-variable-name">callstack</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">function</span>) {
    callstack.index -= strlen(function);
    callstack.funcs[callstack.index] = <span class="org-string">'\0'</span>;
    <span class="org-keyword">return</span> callstack;
}
<span class="org-type">callstack_t</span> <span class="org-function-name">callstack_print</span>(<span class="org-type">callstack_t</span> <span class="org-variable-name">callstack</span>) {
    printf(<span class="org-string">"%s\n"</span>, callstack.funcs);
}

<span class="org-comment-delimiter">/* </span><span class="org-comment">helper macros</span><span class="org-comment-delimiter"> */</span>
<span class="org-preprocessor">#define</span> <span class="org-function-name">TOKEN_PASTE</span>(<span class="org-variable-name">a</span>, <span class="org-variable-name">b</span>) a##b
<span class="org-preprocessor">#define</span> <span class="org-function-name">CONCAT</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>) TOKEN_PASTE(a,b)
<span class="org-preprocessor">#define</span> <span class="org-function-name">UQ</span>(<span class="org-variable-name">name</span>) CONCAT(name, __LINE__) <span class="org-comment-delimiter">// </span><span class="org-comment">UNIQUE IDENTIFIER</span>

<span class="org-preprocessor">#define</span> <span class="org-variable-name">TRACE_CALLSTACK</span>
<span class="org-preprocessor">#ifdef</span> TRACE_CALLSTACK
<span class="org-preprocessor">  #define</span> <span class="org-function-name">FUNC_DECL</span>(<span class="org-variable-name">ret</span>, <span class="org-variable-name">function</span>, ...) <span class="org-type">ret</span> <span class="org-function-name">function</span>(<span class="org-type">callstack_t</span> <span class="org-variable-name">callstack</span>, ##__VA_ARGS__)
<span class="org-preprocessor">  #define</span> <span class="org-function-name">FUNC_CALL</span>(<span class="org-variable-name">function</span>, ...) \
    <span class="org-keyword">for</span> (<span class="org-type">callstack_t</span> <span class="org-function-name">UQ</span>(temp) = (callstack = callstack_enter_function(callstack, #function)); \
         UQ(temp).i == 0; (UQ(temp).i++, callstack_return_from_function(callstack, #function))) { function(callstack, ##__VA_ARGS__); }
<span class="org-preprocessor">#else</span>
<span class="org-preprocessor">  #define</span> <span class="org-function-name">FUNC_DECL</span>(<span class="org-variable-name">ret</span>, <span class="org-variable-name">function</span>, ...) <span class="org-type">ret</span> <span class="org-function-name">function</span>(__VA_ARGS__)
<span class="org-preprocessor">  #define</span> <span class="org-function-name">FUNC_CALL</span>(<span class="org-variable-name">function</span>, ...) function(__VA_ARGS__)
<span class="org-preprocessor">#endif</span>

<span class="org-comment-delimiter">/* </span><span class="org-comment">USAGE</span><span class="org-comment-delimiter"> */</span>
<span class="org-function-name">FUNC_DECL</span>(<span class="org-type">void</span>, helper_func_2) {
    callstack_print(callstack);
}

<span class="org-function-name">FUNC_DECL</span>(<span class="org-type">void</span>, helper_func, <span class="org-type">int</span> <span class="org-variable-name">a</span>);


<span class="org-function-name">FUNC_DECL</span>(<span class="org-type">void</span>, helper_func, <span class="org-type">int</span> <span class="org-variable-name">a</span>) {
    a += 5;
    FUNC_CALL(helper_func_2);
}

<span class="org-type">int</span> <span class="org-function-name">main</span>() {
    callstack_init();
    FUNC_CALL(helper_func, 5);
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgca3b68e" class="outline-3">
<h3 id="orgca3b68e"><a href="#orgca3b68e">Compile-Time String Hashes</a></h3>
<div class="outline-text-3" id="text-orgca3b68e">
<p>
See
</p>
<ul class="org-ul">
<li><a href="https://github.com/Thor-x86/identity.h">https://github.com/Thor-x86/identity.h</a></li>
<li><a href="https://stackoverflow.com/questions/2826559/compile-time-preprocessor-hashing-of-string">https://stackoverflow.com/questions/2826559/compile-time-preprocessor-hashing-of-string</a></li>
<li><a href="https://heeden.nl/statichashc.htm">https://heeden.nl/statichashc.htm</a></li>
</ul>

<p>
An implementation that relies on const folding and doesn't allow using the hash
as case/goto labels (works on clang and MSVC):
</p>
<ul class="org-ul">
<li><a href="https://github.com/Boostibot/c_lib/blob/main/hash_string.h">https://github.com/Boostibot/c_lib/blob/main/hash_string.h</a></li>
</ul>
</div>
</div>
<div id="outline-container-org50fa873" class="outline-3">
<h3 id="org50fa873"><a href="#org50fa873">Recursive Macro Expansion</a></h3>
<div class="outline-text-3" id="text-org50fa873">
<p>
See <a href="https://jadlevesque.github.io/PPMP-Iceberg/explanations#macro-expansion-can-be-recursive-extension">macro expansion can be recursive (extension)</a>.
</p>

<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#2</span><span class="org-string">""</span>3

<span class="org-preprocessor">#define</span> <span class="org-function-name">PRAGMA</span>(...) _Pragma(#__VA_ARGS__)
<span class="org-preprocessor">#define</span> <span class="org-function-name">REVIVE</span>(<span class="org-variable-name">m</span>) PRAGMA(push_macro(#m))PRAGMA(pop_macro(#m))
<span class="org-preprocessor">#define</span> <span class="org-function-name">DEC</span>(<span class="org-variable-name">n</span>,...) (__VA_ARGS__)
<span class="org-preprocessor">#define</span> <span class="org-function-name">FX</span>(<span class="org-variable-name">f</span>,<span class="org-variable-name">x</span>) REVIVE(FX) f x
<span class="org-preprocessor">#define</span> <span class="org-function-name">HOW_MANY_ARGS</span>(...) REVIVE(HOW_MANY_ARGS) \
    __VA_OPT__(+1 FX(HOW_MANY_ARGS, DEC(__VA_ARGS__)))

<span class="org-type">int</span> <span class="org-function-name">main</span> () {
    printf(<span class="org-string">"%i"</span>, HOW_MANY_ARGS(1,2,3,4,5)); <span class="org-comment-delimiter">// </span><span class="org-comment">5</span>
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org25dad06" class="outline-3">
<h3 id="org25dad06"><a href="#org25dad06">Multiple Return Values</a></h3>
<div class="outline-text-3" id="text-org25dad06">
<p>
See <a href="https://github.com/dandersch/multiple_return.h/tree/main">multiple<sub>return.h</sub>: Go-style multiple return in C using macros</a>.
</p>

<p>
Proof-of-concept, problems are:
</p>
<ul class="org-ul">
<li>Doesn't support types with spaces in them (no <code>struct foo</code>)</li>
<li>Requires type declarations in the assignment and return statement of the
function. Could be avoided by using <code>typeof(func)</code>, but there is no (?) way to
get current function as identifier (<code>__FUNCTION__</code> is a char*).</li>
<li>No good way to have syntax like <code>int a, float b = func();</code>, best we could
realistically do is <code>_(a,b) = func();</code></li>
<li>Requires <code>__auto_type</code> (GNU) or C23/C++ <code>auto</code></li>
<li>No C++ support, because <i>"new types may not be defined in a return type"</i></li>
<li>Optimally, we would have an overloaded <code>return</code> statement, i.e. to be able to do
<code>return(4, 2.2)</code>. Would act like normal return with only one argument.</li>
</ul>

<div class="org-src-container">
<pre class="src src-C" id="multiple_return.h"><span class="org-preprocessor">#define</span> <span class="org-function-name">TOKEN_PASTE</span>(<span class="org-variable-name">a</span>, <span class="org-variable-name">b</span>) a##b
<span class="org-preprocessor">#define</span> <span class="org-function-name">CONCAT</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>) TOKEN_PASTE(a,b)
<span class="org-preprocessor">#define</span> <span class="org-function-name">UQ</span>(<span class="org-variable-name">name</span>) CONCAT(name, __LINE__) <span class="org-comment-delimiter">/* </span><span class="org-comment">unique identifier</span><span class="org-comment-delimiter"> */</span>

<span class="org-preprocessor">#define</span> <span class="org-function-name">CAT</span>( <span class="org-variable-name">A</span>, <span class="org-variable-name">B</span> ) A ## B
<span class="org-preprocessor">#define</span> <span class="org-function-name">SELECT</span>( <span class="org-variable-name">NAME</span>, <span class="org-variable-name">NUM</span> ) CAT( NAME ## _, NUM )
<span class="org-preprocessor">#define</span> <span class="org-function-name">GET_COUNT</span>( <span class="org-variable-name">_1</span>, <span class="org-variable-name">_2</span>, <span class="org-variable-name">_3</span>, <span class="org-variable-name">_4</span>, <span class="org-variable-name">_5</span>, <span class="org-variable-name">_6</span> <span class="org-comment-delimiter">/* </span><span class="org-comment">ad nauseam</span><span class="org-comment-delimiter"> */</span>, <span class="org-variable-name">COUNT</span>, ... ) COUNT
<span class="org-preprocessor">#define</span> <span class="org-function-name">VA_SIZE</span>( ... ) GET_COUNT( __VA_ARGS__, 6, 5, 4, 3, 2, 1 )
<span class="org-preprocessor">#define</span> <span class="org-function-name">VA_SELECT</span>( <span class="org-variable-name">NAME</span>, ... ) SELECT( NAME, VA_SIZE(__VA_ARGS__) )(__VA_ARGS__)

<span class="org-comment-delimiter">/* </span><span class="org-comment">support for up to 4 return types</span><span class="org-comment-delimiter"> */</span>
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_struct</span>(...)        VA_SELECT( _mret_struct, __VA_ARGS__ )
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_struct_1</span>(<span class="org-variable-name">a</span>)        <span class="org-keyword">struct</span> <span class="org-type">_</span>##a
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_struct_2</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>)      <span class="org-keyword">struct</span> <span class="org-type">_</span>##a##b
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_struct_3</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>,<span class="org-variable-name">c</span>)    <span class="org-keyword">struct</span> <span class="org-type">_</span>##a##b##c
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_struct_4</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>,<span class="org-variable-name">c</span>,<span class="org-variable-name">d</span>)  <span class="org-keyword">struct</span> <span class="org-type">_</span>##a##b##c##d

<span class="org-preprocessor">#define</span> <span class="org-function-name">ret</span>(...)        VA_SELECT( _ret, __VA_ARGS__ )
<span class="org-preprocessor">#define</span> <span class="org-function-name">_ret_1</span>(<span class="org-variable-name">a</span>)       _mret_struct_1(a)       { <span class="org-type">a</span> <span class="org-variable-name">_0</span>; }
<span class="org-preprocessor">#define</span> <span class="org-function-name">_ret_2</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>)     _mret_struct_2(a,b)     { <span class="org-type">a</span> <span class="org-variable-name">_0</span>; <span class="org-type">b</span> <span class="org-variable-name">_1</span>; }
<span class="org-preprocessor">#define</span> <span class="org-function-name">_ret_3</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>,<span class="org-variable-name">c</span>)   _mret_struct_3(a,b,c)   { <span class="org-type">a</span> <span class="org-variable-name">_0</span>; <span class="org-type">b</span> <span class="org-variable-name">_1</span>; <span class="org-type">c</span> <span class="org-variable-name">_2</span>; }
<span class="org-preprocessor">#define</span> <span class="org-function-name">_ret_4</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>,<span class="org-variable-name">c</span>,<span class="org-variable-name">d</span>) _mret_struct_4(a,b,c,d) { <span class="org-type">a</span> <span class="org-variable-name">_0</span>; <span class="org-type">b</span> <span class="org-variable-name">_1</span>; <span class="org-type">c</span> <span class="org-variable-name">_2</span>; <span class="org-type">d</span> <span class="org-variable-name">_3</span>; }

<span class="org-preprocessor">#define</span> <span class="org-function-name">mreturn</span>(...)      <span class="org-keyword">return</span> (_mret_struct(__VA_ARGS__))

<span class="org-comment-delimiter">/* </span><span class="org-comment">TODO: use auto if C++/C23 instead of __auto_type</span><span class="org-comment-delimiter"> */</span>
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_decl</span>(...)       VA_SELECT( _mret_decl, __VA_ARGS__ )
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_decl_1</span>(<span class="org-variable-name">a</span>)       <span class="org-type">__auto_type</span> <span class="org-variable-name">a</span> = UQ(__ret)._0;
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_decl_2</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>)     <span class="org-type">__auto_type</span> <span class="org-variable-name">a</span> = UQ(__ret)._0; <span class="org-type">__auto_type</span> <span class="org-variable-name">b</span> = UQ(__ret)._1;
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_decl_3</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>,<span class="org-variable-name">c</span>)   <span class="org-type">__auto_type</span> <span class="org-variable-name">a</span> = UQ(__ret)._0; <span class="org-type">__auto_type</span> <span class="org-variable-name">b</span> = UQ(__ret)._1; <span class="org-type">__auto_type</span> <span class="org-variable-name">c</span> = UQ(__ret)._2;
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_decl_4</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>,<span class="org-variable-name">c</span>,<span class="org-variable-name">d</span>) <span class="org-type">__auto_type</span> <span class="org-variable-name">a</span> = UQ(__ret)._0; <span class="org-type">__auto_type</span> <span class="org-variable-name">b</span> = UQ(__ret)._1; <span class="org-type">__auto_type</span> <span class="org-variable-name">c</span> = UQ(__ret)._2; <span class="org-type">__auto_type</span> <span class="org-variable-name">d</span> = UQ(__ret)._3;

<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_assign</span>(...)       VA_SELECT( _mret_assign, __VA_ARGS__ )
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_assign_1</span>(<span class="org-variable-name">a</span>)       a = UQ(__ret)._0;
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_assign_2</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>)     a = UQ(__ret)._0; b = UQ(__ret)._1;
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_assign_3</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>,<span class="org-variable-name">c</span>)   a = UQ(__ret)._0; b = UQ(__ret)._1; c = UQ(__ret)._2;
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_assign_4</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>,<span class="org-variable-name">c</span>,<span class="org-variable-name">d</span>) a = UQ(__ret)._0; b = UQ(__ret)._1; c = UQ(__ret)._2; d = UQ(__ret)._3;

<span class="org-preprocessor">#define</span> <span class="org-function-name">m</span>(...) _mret_struct(__VA_ARGS__) UQ(__ret); _m
<span class="org-preprocessor">#define</span> <span class="org-function-name">_m</span>(...)                       \
    _mret_decl(__VA_ARGS__)           \
    <span class="org-keyword">if</span> (1) <span class="org-keyword">goto</span> <span class="org-constant">UQ</span>(_body);            \
    <span class="org-keyword">else</span> <span class="org-keyword">while</span> (1)                    \
        <span class="org-keyword">if</span> (1) {                      \
            _mret_assign(__VA_ARGS__) \
            <span class="org-keyword">break</span>;                    \
        } <span class="org-keyword">else</span> UQ(_body): UQ(__ret)
</pre>
</div>

<p>
Usage code:
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#define</span> <span class="org-function-name">TOKEN_PASTE</span>(<span class="org-variable-name">a</span>, <span class="org-variable-name">b</span>) a##b
<span class="org-preprocessor">#define</span> <span class="org-function-name">CONCAT</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>) TOKEN_PASTE(a,b)
<span class="org-preprocessor">#define</span> <span class="org-function-name">UQ</span>(<span class="org-variable-name">name</span>) CONCAT(name, __LINE__) <span class="org-comment-delimiter">/* </span><span class="org-comment">unique identifier</span><span class="org-comment-delimiter"> */</span>

<span class="org-preprocessor">#define</span> <span class="org-function-name">CAT</span>( <span class="org-variable-name">A</span>, <span class="org-variable-name">B</span> ) A ## B
<span class="org-preprocessor">#define</span> <span class="org-function-name">SELECT</span>( <span class="org-variable-name">NAME</span>, <span class="org-variable-name">NUM</span> ) CAT( NAME ## _, NUM )
<span class="org-preprocessor">#define</span> <span class="org-function-name">GET_COUNT</span>( <span class="org-variable-name">_1</span>, <span class="org-variable-name">_2</span>, <span class="org-variable-name">_3</span>, <span class="org-variable-name">_4</span>, <span class="org-variable-name">_5</span>, <span class="org-variable-name">_6</span> <span class="org-comment-delimiter">/* </span><span class="org-comment">ad nauseam</span><span class="org-comment-delimiter"> */</span>, <span class="org-variable-name">COUNT</span>, ... ) COUNT
<span class="org-preprocessor">#define</span> <span class="org-function-name">VA_SIZE</span>( ... ) GET_COUNT( __VA_ARGS__, 6, 5, 4, 3, 2, 1 )
<span class="org-preprocessor">#define</span> <span class="org-function-name">VA_SELECT</span>( <span class="org-variable-name">NAME</span>, ... ) SELECT( NAME, VA_SIZE(__VA_ARGS__) )(__VA_ARGS__)

<span class="org-comment-delimiter">/* </span><span class="org-comment">support for up to 4 return types</span><span class="org-comment-delimiter"> */</span>
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_struct</span>(...)        VA_SELECT( _mret_struct, __VA_ARGS__ )
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_struct_1</span>(<span class="org-variable-name">a</span>)        <span class="org-keyword">struct</span> <span class="org-type">_</span>##a
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_struct_2</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>)      <span class="org-keyword">struct</span> <span class="org-type">_</span>##a##b
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_struct_3</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>,<span class="org-variable-name">c</span>)    <span class="org-keyword">struct</span> <span class="org-type">_</span>##a##b##c
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_struct_4</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>,<span class="org-variable-name">c</span>,<span class="org-variable-name">d</span>)  <span class="org-keyword">struct</span> <span class="org-type">_</span>##a##b##c##d

<span class="org-preprocessor">#define</span> <span class="org-function-name">ret</span>(...)        VA_SELECT( _ret, __VA_ARGS__ )
<span class="org-preprocessor">#define</span> <span class="org-function-name">_ret_1</span>(<span class="org-variable-name">a</span>)       _mret_struct_1(a)       { <span class="org-type">a</span> <span class="org-variable-name">_0</span>; }
<span class="org-preprocessor">#define</span> <span class="org-function-name">_ret_2</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>)     _mret_struct_2(a,b)     { <span class="org-type">a</span> <span class="org-variable-name">_0</span>; <span class="org-type">b</span> <span class="org-variable-name">_1</span>; }
<span class="org-preprocessor">#define</span> <span class="org-function-name">_ret_3</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>,<span class="org-variable-name">c</span>)   _mret_struct_3(a,b,c)   { <span class="org-type">a</span> <span class="org-variable-name">_0</span>; <span class="org-type">b</span> <span class="org-variable-name">_1</span>; <span class="org-type">c</span> <span class="org-variable-name">_2</span>; }
<span class="org-preprocessor">#define</span> <span class="org-function-name">_ret_4</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>,<span class="org-variable-name">c</span>,<span class="org-variable-name">d</span>) _mret_struct_4(a,b,c,d) { <span class="org-type">a</span> <span class="org-variable-name">_0</span>; <span class="org-type">b</span> <span class="org-variable-name">_1</span>; <span class="org-type">c</span> <span class="org-variable-name">_2</span>; <span class="org-type">d</span> <span class="org-variable-name">_3</span>; }

<span class="org-preprocessor">#define</span> <span class="org-function-name">mreturn</span>(...)      <span class="org-keyword">return</span> (_mret_struct(__VA_ARGS__))

<span class="org-comment-delimiter">/* </span><span class="org-comment">TODO: use auto if C++/C23 instead of __auto_type</span><span class="org-comment-delimiter"> */</span>
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_decl</span>(...)       VA_SELECT( _mret_decl, __VA_ARGS__ )
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_decl_1</span>(<span class="org-variable-name">a</span>)       <span class="org-type">__auto_type</span> <span class="org-variable-name">a</span> = UQ(__ret)._0;
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_decl_2</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>)     <span class="org-type">__auto_type</span> <span class="org-variable-name">a</span> = UQ(__ret)._0; <span class="org-type">__auto_type</span> <span class="org-variable-name">b</span> = UQ(__ret)._1;
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_decl_3</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>,<span class="org-variable-name">c</span>)   <span class="org-type">__auto_type</span> <span class="org-variable-name">a</span> = UQ(__ret)._0; <span class="org-type">__auto_type</span> <span class="org-variable-name">b</span> = UQ(__ret)._1; <span class="org-type">__auto_type</span> <span class="org-variable-name">c</span> = UQ(__ret)._2;
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_decl_4</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>,<span class="org-variable-name">c</span>,<span class="org-variable-name">d</span>) <span class="org-type">__auto_type</span> <span class="org-variable-name">a</span> = UQ(__ret)._0; <span class="org-type">__auto_type</span> <span class="org-variable-name">b</span> = UQ(__ret)._1; <span class="org-type">__auto_type</span> <span class="org-variable-name">c</span> = UQ(__ret)._2; <span class="org-type">__auto_type</span> <span class="org-variable-name">d</span> = UQ(__ret)._3;

<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_assign</span>(...)       VA_SELECT( _mret_assign, __VA_ARGS__ )
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_assign_1</span>(<span class="org-variable-name">a</span>)       a = UQ(__ret)._0;
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_assign_2</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>)     a = UQ(__ret)._0; b = UQ(__ret)._1;
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_assign_3</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>,<span class="org-variable-name">c</span>)   a = UQ(__ret)._0; b = UQ(__ret)._1; c = UQ(__ret)._2;
<span class="org-preprocessor">#define</span> <span class="org-function-name">_mret_assign_4</span>(<span class="org-variable-name">a</span>,<span class="org-variable-name">b</span>,<span class="org-variable-name">c</span>,<span class="org-variable-name">d</span>) a = UQ(__ret)._0; b = UQ(__ret)._1; c = UQ(__ret)._2; d = UQ(__ret)._3;

<span class="org-preprocessor">#define</span> <span class="org-function-name">m</span>(...) _mret_struct(__VA_ARGS__) UQ(__ret); _m
<span class="org-preprocessor">#define</span> <span class="org-function-name">_m</span>(...)                       \
    _mret_decl(__VA_ARGS__)           \
    <span class="org-keyword">if</span> (1) <span class="org-keyword">goto</span> <span class="org-constant">UQ</span>(_body);            \
    <span class="org-keyword">else</span> <span class="org-keyword">while</span> (1)                    \
        <span class="org-keyword">if</span> (1) {                      \
            _mret_assign(__VA_ARGS__) \
            <span class="org-keyword">break</span>;                    \
        } <span class="org-keyword">else</span> UQ(_body): UQ(__ret)

<span class="org-function-name">ret</span>(<span class="org-type">float</span>, <span class="org-type">int</span>) <span class="org-function-name">multiple_ret</span>(<span class="org-type">int</span> <span class="org-variable-name">a</span>) {
    <span class="org-type">int</span> <span class="org-variable-name">err</span> = -1;
    mreturn(<span class="org-type">float</span>, <span class="org-type">int</span>){4.2 + a, err};
}

<span class="org-type">int</span> <span class="org-function-name">main</span>() {
    m(<span class="org-type">float</span>, <span class="org-type">int</span>)(a, b) = multiple_ret(3);
    printf(<span class="org-string">"%.1f %d\n"</span>, a, b); <span class="org-comment-delimiter">// </span><span class="org-comment">7.2 -1</span>
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org7ced44a" class="outline-2">
<h2 id="org7ced44a"><a href="#org7ced44a">Resources</a></h2>
<div class="outline-text-2" id="text-org7ced44a">
<ul class="org-ul">
<li><a href="https://www.chiark.greenend.org.uk/~sgtatham/mp/">Metaprogramming custom control structures in C</a></li>
<li><a href="https://github.com/pfultz2/Cloak/wiki/C-Preprocessor-tricks,-tips,-and-idioms">C Preprocessor tricks, tips, and idioms</a></li>
<li><a href="https://hirrolot.gitbook.io/metalang99">Metalang99</a>: Full-blown preprocessor metaprogramming</li>
<li><a href="https://github.com/notfoundry/ppstep">ppstep</a>: Interactive C/C++ preprocessor macro debugger</li>
<li><a href="https://jadlevesque.github.io/PPMP-Iceberg/">The Preprocessor Iceberg Meme</a></li>
<li><a href="https://github.com/hirrolot/awesome-c-preprocessor">awesome-c-preprocessor</a></li>
</ul>
</div>
</div>
</main>
</body>
</html>
